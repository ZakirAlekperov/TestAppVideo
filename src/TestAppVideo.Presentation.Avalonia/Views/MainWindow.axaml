<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:TestAppVideo.Presentation.Avalonia.ViewModels"
        x:Class="TestAppVideo.Presentation.Avalonia.Views.MainWindow"
        Width="950" Height="700"
        Title="Видеоредактор - Разделение видео">

  <Design.DataContext>
    <vm:MainWindowViewModel />
  </Design.DataContext>

  <TabControl>
    <!-- Вкладка обработки видео -->
    <TabItem Header="Обработка видео">
      <Grid RowDefinitions="Auto,Auto,*,Auto" ColumnDefinitions="*,*" Margin="16">
        <Grid.Styles>
          <Style Selector="Grid > :is(Control)">
            <Setter Property="Margin" Value="0,6" />
          </Style>
        </Grid.Styles>

        <TextBlock Grid.Row="0" Grid.ColumnSpan="2" FontSize="22" Text="Разделение видео" />

        <StackPanel Grid.Row="1" Grid.ColumnSpan="2" Spacing="8">
          <TextBlock Text="Путь к видеофайлу" />
          <TextBox Text="{Binding InputFilePath}" Watermark="/путь/к/видео.mp4" />

          <TextBlock Text="Папка для сохранения результатов" />
          <TextBox Text="{Binding OutputDirectory}" Watermark="/путь/к/папке" />
        </StackPanel>

        <StackPanel Grid.Row="2" Grid.Column="0" Spacing="10">
          <TextBlock FontSize="16" Text="Настройки разделения" />

          <StackPanel Orientation="Horizontal" Spacing="8">
            <TextBlock VerticalAlignment="Center" Text="Режим:" />
            <ComboBox SelectedIndex="{Binding ModeIndex}" Width="220">
              <ComboBoxItem Content="Равные части" />
              <ComboBoxItem Content="Фиксированная длительность" />
            </ComboBox>
          </StackPanel>

          <TextBlock Text="Количество частей (равные части)" />
          <NumericUpDown Minimum="1" Maximum="1000" Value="{Binding NumberOfParts}" />

          <TextBlock Text="Длительность сегмента в секундах (фиксированная длительность)" />
          <NumericUpDown Minimum="1" Maximum="86400" Value="{Binding SegmentDurationSeconds}" />

          <StackPanel Orientation="Horizontal" Spacing="8">
            <Button Content="Загрузить метаданные" Command="{Binding LoadMetadataCommand}" />
            <Button Content="Предпросмотр" Command="{Binding PreviewCommand}" />
          </StackPanel>

          <StackPanel Orientation="Horizontal" Spacing="8">
            <Button Content="Разделить" Command="{Binding SplitCommand}" />
            <Button Content="Отмена" Command="{Binding CancelCommand}" />
          </StackPanel>

          <ProgressBar Minimum="0" Maximum="100" Value="{Binding Progress}" Height="12" />
          <TextBlock Text="{Binding Status}" TextWrapping="Wrap" />
        </StackPanel>

        <StackPanel Grid.Row="2" Grid.Column="1" Spacing="8">
          <TextBlock FontSize="16" Text="Предпросмотр сегментов" />
          <DataGrid ItemsSource="{Binding PreviewSegments}" AutoGenerateColumns="False" IsReadOnly="True">
            <DataGrid.Columns>
              <DataGridTextColumn Header="№" Binding="{Binding SegmentNumber}" Width="60" />
              <DataGridTextColumn Header="Начало" Binding="{Binding Start}" Width="*" />
              <DataGridTextColumn Header="Конец" Binding="{Binding End}" Width="*" />
              <DataGridTextColumn Header="Имя файла" Binding="{Binding OutputFileName}" Width="2*" />
            </DataGrid.Columns>
          </DataGrid>
        </StackPanel>

      </Grid>
    </TabItem>

    <!-- Вкладка О программе -->
    <TabItem Header="О программе">
      <ScrollViewer>
        <StackPanel Margin="32" Spacing="16" MaxWidth="700">
          <TextBlock FontSize="24" FontWeight="Bold" Text="Видеоредактор - Разделение видео" />
          <TextBlock FontSize="14" Foreground="Gray" Text="Кросс-платформенное приложение для быстрого разделения видео" />

          <Separator Margin="0,8" />

          <TextBlock FontSize="18" FontWeight="SemiBold" Text="Автор" />
          <TextBlock FontSize="14" Text="Закир Алекперов" />

          <Separator Margin="0,8" />

          <TextBlock FontSize="18" FontWeight="SemiBold" Text="Архитектура приложения" />
          <TextBlock TextWrapping="Wrap" FontSize="13" Text="Приложение построено на основе Clean Architecture с явным разделением ответственности между слоями:" />

          <StackPanel Spacing="8" Margin="16,0,0,0">
            <TextBlock TextWrapping="Wrap" FontSize="13">
              <Run FontWeight="SemiBold">Domain Layer (Ядро)</Run>
              <LineBreak />
              Содержит доменные модели (Video, VideoSegment, VideoMetadata), бизнес-правила и инварианты. Не зависит от внешних библиотек и инфраструктуры. Определяет порты (интерфейсы) для работы с видео и файловой системой.
            </TextBlock>

            <TextBlock TextWrapping="Wrap" FontSize="13">
              <Run FontWeight="SemiBold">Application Layer (Сценарии использования)</Run>
              <LineBreak />
              Оркестрирует use cases (загрузка метаданных, предпросмотр разделения, обработка видео). Содержит DTOs для передачи данных между слоями и валидацию входных параметров. Зависит только от Domain Layer.
            </TextBlock>

            <TextBlock TextWrapping="Wrap" FontSize="13">
              <Run FontWeight="SemiBold">Infrastructure Layer (Инфраструктура)</Run>
              <LineBreak />
              Реализует адаптеры для работы с FFmpeg (через библиотеку FFMpegCore) и файловой системой. Изолирует внешние зависимости от бизнес-логики. Может быть заменён без изменения ядра приложения.
            </TextBlock>

            <TextBlock TextWrapping="Wrap" FontSize="13">
              <Run FontWeight="SemiBold">Presentation Layer (Пользовательский интерфейс)</Run>
              <LineBreak />
              Реализован на Avalonia UI с применением паттерна MVVM. Обеспечивает кросс-платформенность (Windows, macOS, Linux). Взаимодействует с приложением через application service (фасад).
            </TextBlock>
          </StackPanel>

          <Separator Margin="0,8" />

          <TextBlock FontSize="18" FontWeight="SemiBold" Text="Принципы разработки" />
          <StackPanel Spacing="4" Margin="16,0,0,0">
            <TextBlock TextWrapping="Wrap" FontSize="13" Text="• Явные зависимости через интерфейсы (Dependency Injection)" />
            <TextBlock TextWrapping="Wrap" FontSize="13" Text="• Изоляция платформенно-специфичного кода" />
            <TextBlock TextWrapping="Wrap" FontSize="13" Text="• Предсказуемость и читаемость кода" />
            <TextBlock TextWrapping="Wrap" FontSize="13" Text="• Тестируемость всех компонентов" />
            <TextBlock TextWrapping="Wrap" FontSize="13" Text="• Готовность к масштабированию функциональности" />
          </StackPanel>

          <Separator Margin="0,8" />

          <TextBlock FontSize="18" FontWeight="SemiBold" Text="Технологии" />
          <StackPanel Spacing="4" Margin="16,0,0,0">
            <TextBlock FontSize="13" Text="• .NET 10" />
            <TextBlock FontSize="13" Text="• Avalonia UI 11.0.10" />
            <TextBlock FontSize="13" Text="• FFMpegCore 5.1.0 (обёртка над FFmpeg)" />
            <TextBlock FontSize="13" Text="• Microsoft.Extensions.DependencyInjection" />
          </StackPanel>

          <Separator Margin="0,8" />

          <TextBlock FontSize="12" Foreground="Gray" TextWrapping="Wrap" Text="Для работы приложения требуется установленный FFmpeg в системе (доступный в PATH)." />
        </StackPanel>
      </ScrollViewer>
    </TabItem>
  </TabControl>

</Window>
